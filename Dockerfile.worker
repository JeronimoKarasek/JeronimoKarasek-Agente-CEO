FROM python:3.12-slim

WORKDIR /app
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt
COPY app ./app

ENV PYTHONPATH=/app
CMD ["python", "-c", "from app.workers.worker import poll_and_run_once; import time;\nprint('Worker started');\n\nwhile True:\n    try:\n        processed = poll_and_run_once()\n        time.sleep(2 if processed==0 else 0)\n    except Exception as e:\n        print('Worker error', e)\n        time.sleep(5)\n"]

